---
title: "S04: Digital Twin API Specification"
type: "system_spec"
status: "active"
system_id: "S04"
goal_id: "goal-g04"
owner: "{{OWNER_NAME}}"
updated: "2026-02-21"
---

# S04: Digital Twin API

## Purpose
The Digital Twin API acts as the central intelligence hub for the entire autonomous ecosystem. It aggregates data from health (G01/G07), finance (G05), and logistics (G03) systems to provide a unified "State of the Self" and a consolidated task orchestration layer.

## Triggers
- **Continuous:** Uvicorn server running on port `5677`.
- **On-Demand:** Polled by Obsidian Daily Manager, n8n workflows, and the `todo` CLI.

## Endpoints

### 1. `GET /status`
**Description:** Returns a human-readable summary and the raw state of all integrated systems.
- **Outputs:** JSON object containing `summary` (string) and `state` (nested object).

### 2. `GET /tasks`
**Description:** Consolidated task view aggregating multiple sources. Supports filtering by Roadmap quarter.
- **Parameters:** 
    - `quarter` (optional): Filter for `Q1`, `Q2`, `Q3`, or `Q4` roadmap tasks.
- **Inputs:**
    - Google Tasks API (via `G10_google_tasks_sync.py`)
    - Goal Roadmaps (via `docs/10_Goals/GXX_*/Roadmap.md`)
    - System State (Pantry low stock, Workout due dates, Budget alerts)
- **Outputs:**
    - `google_tasks`: Upcoming items from Google.
    - `roadmap_tasks`: Incomplete items from goal roadmaps.
    - `system_tasks`: Priority alerts generated by system logic.

### 3. `GET /health` | `GET /finance`
**Description:** Specialized endpoints for deep-dives into specific domain metrics.

## CLI Integration: `todo`
The system is equipped with a CLI wrapper (`G10_digital_twin_cli.py`) to provide instant access to the task layer.
- **Usage:** 
    - `python scripts/G04_digital_twin_cli.py` (All tasks)
    - `python scripts/G04_digital_twin_cli.py Q1` (Quarterly roadmap focus)

## Dependencies

### Systems
- [S03 Data Layer](../S03_Data-Layer/README.md) (PostgreSQL: `autonomous_finance`, `autonomous_training`, `autonomous_pantry`)
- [S09 Productivity](../S09_Productivity-Time/README.md) (Google Tasks integration)

### External Services
- Google Tasks API (OAuth2 credentials in `scripts/client_secret.json`)

### Credentials
- PostgreSQL: `root:admin@localhost:5432`
- Google OAuth Token: `scripts/google_tasks_token.pickle`

## Failure Modes

| Failure Scenario | Detection | Response | Alert |
|---|---|---|---|
| API Offline | `G11_meta_mapper` reports "Offline" | Run `python G04_digital_twin_api.py` | Obsidian Health Tag |
| DB Connection Fail | API logs `psycopg2.OperationalError` | Check Docker container status | Console Output |
| Google Auth Expired | `G10_google_tasks_sync` returns error | Re-run script to trigger OAuth flow | CLI Warning |

## Security Notes
- **Local Access Only:** API binds to `0.0.0.0` but is intended for local network/homelab use.
- **Data Privacy:** Contains sensitive financial and health data. Do not expose port 5677 to the public internet.

---
*Related Documentation:*
- [G04 Digital Twin Goal](../../10_Goals/G04_Digital-Twin-Ecosystem/README.md)
- [S03 Data Layer Specification](../S03_Data-Layer/README.md)
- [G11 Meta-System Connectivity Map](../../10_Goals/G11_Meta-System-Integration-Optimization/G11_System_Connectivity_Map.md)
